<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rifqy Al-Quran Gold</title>
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Outfit:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg-body: #000000;
            --bg-card: #121212;
            --bg-input: #1E1E1E;
            --primary: #D4AF37; /* Gold */
            --primary-dim: rgba(212, 175, 55, 0.15);
            --text-main: #FFFFFF;
            --text-sec: #888888;
            --border: #222222;
            
            /* Tajwid Colors - Neon Style */
            --tj-allah: #FFD700;
            --tj-ghunnah: #FF69B4;
            --tj-qalqalah: #00FFFF;
            --tj-mad: #FF4500;
            --tj-iqlab: #32CD32;
            --tj-ikhfa: #FFA500;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body {
            background-color: var(--bg-body);
            color: var(--text-main);
            font-family: 'Outfit', sans-serif;
            margin: 0; padding: 0;
            height: 100vh;
            overflow: hidden;
            display: flex; flex-direction: column;
        }

        /* --- LAYOUT UTILS --- */
        .flex-center { display: flex; align-items: center; justify-content: center; }
        .flex-between { display: flex; align-items: center; justify-content: space-between; }
        .hidden { display: none !important; }
        .scroll-y { overflow-y: auto; scroll-behavior: smooth; -webkit-overflow-scrolling: touch; }

        /* --- HEADER --- */
        .header {
            height: 60px;
            padding: 0 20px;
            border-bottom: 1px solid var(--border);
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(10px);
            position: fixed; top: 0; width: 100%; z-index: 50;
        }
        .header h1 { font-size: 18px; font-weight: 700; letter-spacing: 0.5px; color: var(--primary); margin: 0; }
        .header-actions i { font-size: 18px; color: var(--text-main); margin-left: 20px; cursor: pointer; }

        /* --- MAIN CONTENT AREA --- */
        #main-container {
            flex: 1;
            margin-top: 60px;
            padding-bottom: 140px; /* Space for player + nav */
            padding-left: 15px; padding-right: 15px;
        }

        /* --- CARDS --- */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            transition: transform 0.2s;
        }
        .card:active { transform: scale(0.98); background: #1a1a1a; }
        
        .surah-row { display: flex; align-items: center; }
        .surah-badge {
            width: 40px; height: 40px;
            border-radius: 10px;
            background: var(--bg-input);
            color: var(--primary);
            font-weight: 700;
            margin-right: 15px;
            border: 1px solid #333;
        }
        .surah-title { font-size: 16px; font-weight: 600; margin-bottom: 4px; }
        .surah-meta { font-size: 12px; color: var(--text-sec); }
        .surah-arabic { margin-left: auto; font-family: 'Amiri', serif; font-size: 20px; color: var(--primary); }

        /* --- READING VIEW --- */
        .ayah-card {
            padding: 24px 10px;
            border-bottom: 1px solid var(--border);
            position: relative;
        }
        .ayah-card.playing {
            background: var(--primary-dim);
            border-left: 3px solid var(--primary);
            border-radius: 8px;
        }
        .ayah-header { margin-bottom: 15px; }
        .ayah-num { 
            background: var(--bg-input); padding: 4px 10px; border-radius: 20px; 
            font-size: 11px; color: var(--primary); font-weight: 600;
        }
        .ayah-actions i { margin-left: 15px; color: var(--text-sec); font-size: 16px; }
        .ayah-actions i:active { color: var(--primary); }

        .arabic-text {
            font-family: 'Amiri', serif;
            font-size: 32px;
            line-height: 2.5;
            text-align: right;
            direction: rtl;
            color: #fff;
            margin-bottom: 20px;
        }
        
        /* Tajwid Highlight */
        .t-rule { cursor: pointer; border-bottom: 2px solid transparent; transition: 0.2s; }
        .t-rule:active { border-bottom-color: currentColor; opacity: 0.8; }
        .c-allah { color: var(--tj-allah); text-shadow: 0 0 10px rgba(255,215,0,0.3); }
        .c-ghunnah { color: var(--tj-ghunnah); text-shadow: 0 0 10px rgba(255,105,180,0.3); }
        .c-qalqalah { color: var(--tj-qalqalah); text-shadow: 0 0 10px rgba(0,255,255,0.3); }
        .c-mad { color: var(--tj-mad); text-shadow: 0 0 10px rgba(255,69,0,0.3); }

        .trans-text { font-size: 14px; line-height: 1.6; color: #ccc; }
        .latin-text { font-size: 13px; color: var(--primary); font-style: italic; margin-bottom: 8px; }

        /* --- STICKY PLAYER --- */
        #sticky-player {
            position: fixed; bottom: 75px; left: 15px; right: 15px;
            background: rgba(25, 25, 25, 0.95);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            height: 60px;
            padding: 0 15px;
            z-index: 90;
            display: none; /* Hidden by default */
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .player-track h4 { margin: 0; font-size: 13px; color: var(--primary); }
        .player-track span { font-size: 11px; color: #aaa; }
        .player-ctrls i { font-size: 24px; color: #fff; margin-left: 20px; cursor: pointer; }

        /* --- BOTTOM NAVIGATION --- */
        .bottom-nav {
            position: fixed; bottom: 0; width: 100%; height: 70px;
            background: #050505;
            border-top: 1px solid var(--border);
            display: flex; justify-content: space-around;
            padding-bottom: 15px; /* iOS Safe Area */
            z-index: 100;
        }
        .nav-item {
            flex: 1; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            color: #555; font-size: 10px; font-weight: 500;
        }
        .nav-item i { font-size: 20px; margin-bottom: 6px; }
        .nav-item.active { color: var(--primary); }
        .nav-item.active i { transform: translateY(-2px); transition: 0.3s; }

        /* --- BOTTOM SHEET (TAJWID / SEARCH) --- */
        .bottom-sheet-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 200;
            display: none; opacity: 0; transition: opacity 0.3s;
        }
        .bottom-sheet {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: #181818;
            border-radius: 20px 20px 0 0;
            padding: 25px;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            z-index: 201; border-top: 1px solid var(--primary);
        }
        .bs-visible { transform: translateY(0); }
        .sheet-handle {
            width: 40px; height: 4px; background: #333;
            border-radius: 2px; margin: 0 auto 20px auto;
        }
        .sheet-title { color: var(--primary); font-size: 18px; margin-bottom: 10px; font-weight: 700; }

        /* --- MODAL FULLSCREEN (DOA / TOOLS) --- */
        .fs-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-body); z-index: 300;
            display: none; flex-direction: column;
        }
        .fs-header { padding: 15px 20px; border-bottom: 1px solid var(--border); height: 60px; }
        
        /* --- UTILS --- */
        .btn-gold { width: 100%; background: var(--primary); color: #000; padding: 14px; border-radius: 12px; font-weight: 700; border: none; margin-top: 15px; }
        input.dark-input { width: 100%; background: var(--bg-input); border: 1px solid #333; color: #fff; padding: 12px; border-radius: 8px; }
        
        /* Font Range */
        input[type=range] { width: 100%; accent-color: var(--primary); }

    </style>
</head>
<body>

    <div class="bottom-sheet-overlay" id="overlay" onclick="closeSheet()"></div>
    
    <div class="bottom-sheet" id="sheet-tajwid">
        <div class="sheet-handle"></div>
        <div class="flex-center" style="margin-bottom:15px;"><i class="fas fa-book-open" style="font-size:30px; color:var(--primary);"></i></div>
        <div style="text-align:center;">
            <div class="sheet-title" id="tj-title">Hukum Tajwid</div>
            <p id="tj-desc" style="color:#ccc; line-height:1.5;">Penjelasan detail akan muncul di sini.</p>
        </div>
    </div>

    <div class="bottom-sheet" id="sheet-search">
        <div class="sheet-handle"></div>
        <div class="sheet-title">Cari Cepat</div>
        <div style="display:flex; gap:10px;">
            <div style="flex:1;">
                <label style="font-size:12px; color:#777;">Nomor Surat</label>
                <input type="number" id="qs-surah" class="dark-input" placeholder="Contoh: 18">
            </div>
            <div style="flex:1;">
                <label style="font-size:12px; color:#777;">Nomor Ayat</label>
                <input type="number" id="qs-ayah" class="dark-input" placeholder="Contoh: 10">
            </div>
        </div>
        <button class="btn-gold" onclick="executeSearch()">Lompat ke Ayat</button>
    </div>

    <div class="bottom-sheet" id="sheet-timer">
        <div class="sheet-handle"></div>
        <div class="sheet-title">Sleep Timer (Auto Stop)</div>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <button class="card" onclick="setTimer(15)">15 Menit</button>
            <button class="card" onclick="setTimer(30)">30 Menit</button>
            <button class="card" onclick="setTimer(60)">60 Menit</button>
            <button class="card" onclick="setTimer(0)" style="border-color:red; color:red;">Matikan</button>
        </div>
        <p id="timer-status" style="text-align:center; font-size:12px; color:#777; margin-top:10px;">Timer mati</p>
    </div>

    <div class="fs-modal" id="modal-doa">
        <div class="fs-header flex-between">
            <i class="fas fa-arrow-left" onclick="closeModal('doa')"></i>
            <h3 style="margin:0; color:var(--primary);">Kumpulan Doa</h3>
            <div style="width:20px;"></div>
        </div>
        <div class="scroll-y" style="padding:15px;" id="doa-container">
            </div>
    </div>

    <div class="header flex-between">
        <h1>RIFQY GOLD</h1>
        <div class="header-actions">
            <i class="fas fa-search" onclick="openSheet('search')"></i>
        </div>
    </div>

    <div id="main-container" class="scroll-y">
        
        <div id="view-home">
            <div id="surah-list">
                <div style="text-align:center; margin-top:50px; color:#555;">
                    <i class="fas fa-circle-notch fa-spin"></i> Memuat Data...
                </div>
            </div>
        </div>

        <div id="view-read" class="hidden">
            <div style="padding:15px 0; border-bottom:1px solid #222; margin-bottom:15px; display:flex; align-items:center;">
                <i class="fas fa-arrow-left" onclick="goHome()" style="padding:10px; margin-right:10px;"></i>
                <div>
                    <h2 id="read-title" style="margin:0; font-size:18px; color:var(--primary);">Nama Surat</h2>
                    <span id="read-info" style="font-size:12px; color:#777;">Info</span>
                </div>
            </div>
            <div id="ayat-container"></div>
        </div>

        <div id="view-settings" class="hidden">
            <h2 style="color:var(--primary); margin-bottom:20px;">Pengaturan</h2>
            
            <div class="card">
                <div class="flex-between">
                    <span>Tajwid Mode (Haptic)</span>
                    <input type="checkbox" checked id="set-tajwid" onchange="toggleSetting('tajwid')">
                </div>
            </div>
            <div class="card">
                <div class="flex-between">
                    <span>Auto-Play Audio</span>
                    <input type="checkbox" checked id="set-autoplay" onchange="toggleSetting('autoplay')">
                </div>
            </div>
            
            <div class="card">
                <label style="display:block; margin-bottom:10px;">Ukuran Font Arab</label>
                <input type="range" min="24" max="50" value="32" oninput="changeFont(this.value, 'size')">
            </div>

             <div class="card">
                <label style="display:block; margin-bottom:10px;">Ketebalan Font (Smart Weight)</label>
                <input type="range" min="300" max="800" step="100" value="400" oninput="changeFont(this.value, 'weight')">
            </div>
        </div>

         <div id="view-tools" class="hidden">
            <h2 style="color:var(--primary); margin-bottom:20px;">Toolbox</h2>
            <div class="card flex-center" onclick="openModal('doa')" style="flex-direction:column; padding:30px;">
                <i class="fas fa-hands-praying" style="font-size:30px; color:var(--primary); margin-bottom:10px;"></i>
                <h3>Kumpulan Doa Lengkap</h3>
                <p style="color:#777; font-size:12px;">Harian, Sholat, Safar, dll</p>
            </div>
            </div>

    </div>

    <div id="sticky-player" class="flex-between">
        <div class="player-track">
            <h4 id="pl-title">Al-Fatihah : 1</h4>
            <span id="pl-time">00:00 / 00:00</span>
        </div>
        <div class="player-ctrls flex-center">
            <i class="fas fa-clock" onclick="openSheet('timer')" style="font-size:16px; margin-right:15px; color:#888;"></i>
            <i class="fas fa-backward" onclick="prevAyah()"></i>
            <i class="fas fa-play" id="pl-btn" onclick="togglePlay()"></i>
            <i class="fas fa-forward" onclick="nextAyah()"></i>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="navTo('home', this)">
            <i class="fas fa-quran"></i> Home
        </div>
        <div class="nav-item" onclick="navTo('tools', this)">
            <i class="fas fa-shapes"></i> Tools
        </div>
        <div class="nav-item" onclick="navTo('settings', this)">
            <i class="fas fa-cog"></i> Settings
        </div>
    </div>

    <audio id="audio-engine" preload="auto"></audio>

<script>
    // --- STATE ---
    const STATE = {
        surahs: [],
        currSurah: null,
        currAyahIdx: 0,
        audio: document.getElementById('audio-engine'),
        settings: {
            tajwid: true,
            autoplay: true,
            fontSize: 32,
            fontWeight: 400
        },
        timer: null
    };

    // --- INIT ---
    document.addEventListener('DOMContentLoaded', () => {
        fetchSurahList();
        loadDoaData();
        
        // Audio Listeners
        STATE.audio.addEventListener('timeupdate', updateProgress);
        STATE.audio.addEventListener('ended', handleAudioEnd);
        STATE.audio.addEventListener('play', () => updatePlayBtn(true));
        STATE.audio.addEventListener('pause', () => updatePlayBtn(false));
    });

    // --- DATA ---
    async function fetchSurahList() {
        try {
            const res = await fetch('https://equran.id/api/v2/surat');
            const json = await res.json();
            STATE.surahs = json.data;
            renderHome(STATE.surahs);
        } catch(e) { alert("Gagal memuat data. Periksa internet."); }
    }

    function renderHome(list) {
        const container = document.getElementById('surah-list');
        container.innerHTML = list.map(s => `
            <div class="card surah-row" onclick="openSurah(${s.nomor})">
                <div class="surah-badge flex-center">${s.nomor}</div>
                <div>
                    <div class="surah-title">${s.namaLatin}</div>
                    <div class="surah-meta">${s.arti} • ${s.jumlahAyat} Ayat</div>
                </div>
                <div class="surah-arabic">${s.nama}</div>
            </div>
        `).join('');
    }

    // --- READING LOGIC ---
    async function openSurah(nomor) {
        document.getElementById('view-home').classList.add('hidden');
        document.getElementById('view-read').classList.remove('hidden');
        document.getElementById('ayat-container').innerHTML = '<div style="text-align:center; padding:50px;"><i class="fas fa-circle-notch fa-spin"></i></div>';
        
        try {
            const res = await fetch(`https://equran.id/api/v2/surat/${nomor}`);
            const json = await res.json();
            STATE.currSurah = json.data;
            
            document.getElementById('read-title').innerText = STATE.currSurah.namaLatin;
            document.getElementById('read-info').innerText = `${STATE.currSurah.tempatTurun} • ${STATE.currSurah.jumlahAyat} Ayat`;
            
            renderAyat(STATE.currSurah.ayat);
        } catch(e) { alert("Error load ayat"); goHome(); }
    }

    function renderAyat(ayatList) {
        let html = '';
        if(STATE.currSurah.nomor !== 9) {
            html += `<div style="text-align:center; font-family:'Amiri'; font-size:28px; color:var(--primary); margin:20px 0;">بِسْمِ اللّٰهِ الرَّحْمٰنِ الرَّحِيْمِ</div>`;
        }

        html += ayatList.map((a, i) => `
            <div class="ayah-card" id="ayah-${i}" data-audio="${a.audio['05']}">
                <div class="ayah-header flex-between">
                    <div class="ayah-num">${STATE.currSurah.nomor}:${a.nomorAyat}</div>
                    <div class="ayah-actions">
                        <i class="fas fa-play" onclick="playAyah(${i})"></i>
                        <i class="fas fa-bookmark" onclick="alert('Disimpan')"></i>
                    </div>
                </div>
                <div class="arabic-text" style="font-size:${STATE.settings.fontSize}px; font-weight:${STATE.settings.fontWeight};">
                    ${STATE.settings.tajwid ? applyTajwid(a.teksArab) : a.teksArab}
                </div>
                <div class="latin-text">${a.teksLatin}</div>
                <div class="trans-text">${a.terjemah}</div>
            </div>
        `).join('');
        
        document.getElementById('ayat-container').innerHTML = html;
    }

    // --- TAJWID ENGINE (HAPTIC & POPUP) ---
    function applyTajwid(text) {
        // Regex Logic
        text = text.replace(/اللّٰه/g, `<span class="t-rule c-allah" onclick="showTajwid('Lafadz Allah', 'Lam Jalalah dibaca tebal/tipis sesuai harakat sebelumnya.')">$&</span>`);
        text = text.replace(/([نم])[\u0651]/g, `<span class="t-rule c-ghunnah" onclick="showTajwid('Ghunnah', 'Huruf Nun/Mim bertasydid. Wajib dengung ditahan 2-3 harakat.')">$&</span>`);
        text = text.replace(/([بجدطق])\u0652/g, `<span class="t-rule c-qalqalah" onclick="showTajwid('Qalqalah', 'Pantulkan suara huruf ini (Ba, Jim, Dal, Tho, Qof).')">$&</span>`);
        text = text.replace(/[\u0653]/g, `<span class="t-rule c-mad" onclick="showTajwid('Mad Wajib/Jaiz', 'Bacaan panjang 4 sampai 5 harakat (ketukan).')">$&</span>`);
        return text;
    }

    function showTajwid(title, desc) {
        // Haptic Pulse
        if(navigator.vibrate) navigator.vibrate(50); // 50ms pulse
        
        document.getElementById('tj-title').innerText = title;
        document.getElementById('tj-desc').innerText = desc;
        openSheet('tajwid');
    }

    // --- AUDIO SYSTEM V3 ---
    function playAyah(idx) {
        STATE.currAyahIdx = idx;
        const card = document.getElementById(`ayah-${idx}`);
        const url = card.getAttribute('data-audio');
        
        STATE.audio.src = url;
        STATE.audio.play();
        
        // UI Sticky
        document.getElementById('sticky-player').style.display = 'flex';
        document.getElementById('pl-title').innerText = `${STATE.currSurah.namaLatin} : ${idx+1}`;
        
        // Highlight & Scroll (Karaoke)
        document.querySelectorAll('.playing').forEach(el => el.classList.remove('playing'));
        card.classList.add('playing');
        card.scrollIntoView({behavior: "smooth", block: "center"});
    }

    function handleAudioEnd() {
        if(STATE.settings.autoplay && STATE.currAyahIdx < STATE.currSurah.ayat.length - 1) {
            playAyah(STATE.currAyahIdx + 1);
        } else {
            updatePlayBtn(false);
        }
    }

    function togglePlay() {
        STATE.audio.paused ? STATE.audio.play() : STATE.audio.pause();
    }
    
    function nextAyah() { 
        if(STATE.currAyahIdx < STATE.currSurah.ayat.length - 1) playAyah(STATE.currAyahIdx + 1);
    }
    
    function prevAyah() {
        if(STATE.currAyahIdx > 0) playAyah(STATE.currAyahIdx - 1);
    }

    function updatePlayBtn(isPlaying) {
        document.getElementById('pl-btn').className = isPlaying ? 'fas fa-pause' : 'fas fa-play';
    }

    function updateProgress() {
        const cur = STATE.audio.currentTime;
        const dur = STATE.audio.duration || 0;
        document.getElementById('pl-time').innerText = fmtTime(cur) + ' / ' + fmtTime(dur);
    }

    function fmtTime(s) {
        const min = Math.floor(s / 60);
        const sec = Math.floor(s % 60);
        return `${min}:${sec<10?'0'+sec:sec}`;
    }

    // --- SLEEP TIMER ---
    function setTimer(min) {
        if(STATE.timer) clearTimeout(STATE.timer);
        
        if(min === 0) {
            document.getElementById('timer-status').innerText = "Timer mati";
            alert("Timer Dimatikan");
        } else {
            document.getElementById('timer-status').innerText = `Akan berhenti dalam ${min} menit`;
            alert(`Audio berhenti dalam ${min} menit`);
            STATE.timer = setTimeout(() => {
                STATE.audio.pause();
                alert("Waktu Habis (Sleep Timer)");
            }, min * 60000);
        }
        closeSheet();
    }

    // --- QUICK SEARCH ---
    function executeSearch() {
        const s = document.getElementById('qs-surah').value;
        const a = document.getElementById('qs-ayah').value;
        
        if(s && a) {
            closeSheet();
            if(STATE.currSurah && STATE.currSurah.nomor == s) {
                // Same surah
                jumpToAyahID(a);
            } else {
                // Different surah
                openSurah(s).then(() => {
                    setTimeout(() => jumpToAyahID(a), 1000); // Wait render
                });
            }
        }
    }

    function jumpToAyahID(num) {
        const idx = num - 1;
        const el = document.getElementById(`ayah-${idx}`);
        if(el) {
            el.scrollIntoView({behavior: "smooth", block: "center"});
            el.style.backgroundColor = "#222";
            setTimeout(() => el.style.backgroundColor = "transparent", 2000);
        } else {
            alert("Ayat tidak ditemukan");
        }
    }

    // --- DATA DOA (EXPANDED) ---
    function loadDoaData() {
        // Data Doa Kategorisasi
        const doas = [
            { cat: "Harian", items: [
                { t: "Bangun Tidur", a: "الْحَمْدُ لِلَّهِ الَّذِي أَحْيَانَا بَعْدَ مَا أَمَاتَنَا وَإِلَيْهِ النُّشُورُ" },
                { t: "Sebelum Tidur", a: "بِسْمِكَ اللّهُمَّ اَحْيَا وَ بِسْمِكَ اَمُوْتُ" },
                { t: "Masuk Masjid", a: "اللَّهُمَّ افْتَحْ لِي أَبْوَابَ رَحْمَتِكَ" },
                { t: "Keluar Masjid", a: "اللَّهُمَّ إِنِّي أَسْأَلُكَ مِنْ فَضْلِكَ" }
            ]},
            { cat: "Perlindungan & Darurat", items: [
                { t: "Mohon Keselamatan", a: "اللَّهُمَّ أَنْتَ السَّلاَمُ وَمِنْكَ السَّلاَمُ تَبَارَكْتَ يَا ذَا الْجَلاَلِ وَالإِكْرَامِ" },
                { t: "Sapu Jagat", a: "رَبَّنَا آتِنَا فِي الدُّنْيَا حَسَنَةً وَفِي الْآخِرَةِ حَسَنَةً وَقِنَا عَذَابَ النَّارِ" },
                { t: "Tolak Bala", a: "اللَّهُمَّ ادْفَعْ عَنَّا الْغَلَاءَ وَالْبَلَاءَ وَالْوَبَاءَ" }
            ]},
            { cat: "Sholat & Ibadah", items: [
                { t: "Iftitah Singkat", a: "اللَّهُمَّ بَاعِدْ بَيْنِي وَبَيْنَ خَطَايَايَ كَمَا بَاعَدْتَ بَيْنَ الْمَشْرِقِ وَالْمَغْرِبِ" },
                { t: "Qunut Subuh", a: "اللَّهُمَّ اهْدِنِي فِيمَنْ هَدَيْتَ وَعَافِنِي فِيمَنْ عَافَيْتَ" }
            ]}
        ];

        let html = '';
        doas.forEach(grp => {
            html += `<h4 style="color:var(--text-sec); margin:20px 0 10px 0; border-bottom:1px solid #333; padding-bottom:5px;">${grp.cat}</h4>`;
            grp.items.forEach(d => {
                html += `
                <div class="card">
                    <div style="color:var(--primary); font-weight:600; margin-bottom:10px;">${d.t}</div>
                    <div style="font-family:'Amiri'; font-size:22px; text-align:right;">${d.a}</div>
                </div>`;
            });
        });
        document.getElementById('doa-container').innerHTML = html;
    }

    // --- UI HELPERS ---
    function openSheet(id) {
        document.getElementById('overlay').style.display = 'block';
        setTimeout(() => document.getElementById('overlay').style.opacity = 1, 10);
        document.getElementById('sheet-'+id).classList.add('bs-visible');
    }

    function closeSheet() {
        document.getElementById('overlay').style.opacity = 0;
        setTimeout(() => document.getElementById('overlay').style.display = 'none', 300);
        document.querySelectorAll('.bottom-sheet').forEach(el => el.classList.remove('bs-visible'));
    }

    function openModal(id) {
        document.getElementById('modal-'+id).style.display = 'flex';
    }
    
    function closeModal(id) {
        document.getElementById('modal-'+id).style.display = 'none';
    }

    function navTo(view, el) {
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
        
        ['home', 'tools', 'settings', 'read'].forEach(v => {
            const div = document.getElementById('view-'+v);
            if(div) div.classList.add('hidden');
        });
        
        // Logic nav
        if(view === 'home') document.getElementById('view-home').classList.remove('hidden');
        if(view === 'settings') document.getElementById('view-settings').classList.remove('hidden');
        if(view === 'tools') document.getElementById('view-tools').classList.remove('hidden');
    }

    function goHome() {
        navTo('home', document.querySelector('.nav-item')); // Back to home logic
    }

    function changeFont(val, type) {
        if(type === 'size') {
            STATE.settings.fontSize = val;
            document.querySelectorAll('.arabic-text').forEach(el => el.style.fontSize = val + 'px');
        } else {
            STATE.settings.fontWeight = val;
            document.querySelectorAll('.arabic-text').forEach(el => el.style.fontWeight = val);
        }
    }

    function toggleSetting(key) {
        STATE.settings[key] = !STATE.settings[key];
        if(key === 'tajwid' && STATE.currSurah) renderAyat(STATE.currSurah.ayat); // Rerender
    }

</script>
</body>
</html>
