<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rifqy Al-Quran OLED Ultimate</title>
    <meta name="theme-color" content="#000000">
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Outfit:wght@300;400;600&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg: #000000;
            --card-bg: #0f0f0f;
            --glass: rgba(20, 20, 20, 0.85);
            --gold: #D4AF37;
            --gold-glow: rgba(212, 175, 55, 0.3);
            --text-main: #ffffff;
            --text-mute: #888888;
            
            /* Tajwid Colors */
            --tj-allah: #FFD700;
            --tj-ghunnah: #FF69B4;
            --tj-qalqalah: #00FFFF;
            --tj-mad: #FF4500;
            --tj-iqlab: #32CD32;
            --tj-ikhfa: #FFA500;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body {
            background-color: var(--bg);
            color: var(--text-main);
            font-family: 'Outfit', sans-serif;
            margin: 0; padding: 0;
            height: 100vh;
            overflow: hidden; /* App-like feel */
            display: flex; flex-direction: column;
        }

        /* --- UI COMPONENTS --- */
        
        /* 1. Top Bar */
        .top-bar {
            padding: 15px 20px;
            background: var(--glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            position: fixed; top: 0; left: 0; right: 0; z-index: 50;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            display: flex; justify-content: space-between; align-items: center;
            height: 60px;
        }
        .app-logo { font-size: 18px; font-weight: 700; color: var(--gold); letter-spacing: 1px; }
        .clock-widget { font-size: 12px; color: var(--text-mute); text-align: right; }

        /* 2. Main Content Area */
        #main-view {
            flex: 1;
            margin-top: 60px; /* Header height */
            margin-bottom: 70px; /* Bottom Nav height */
            overflow-y: auto;
            scroll-behavior: smooth;
            padding: 10px;
        }

        /* 3. Surah List Cards */
        .surah-card {
            background: var(--card-bg);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex; align-items: center;
            transition: all 0.2s ease;
        }
        .surah-card:active { transform: scale(0.98); background: #1a1a1a; }
        .s-num { 
            width: 40px; height: 40px; 
            background: linear-gradient(135deg, #222, #000);
            border: 1px solid var(--gold);
            border-radius: 12px;
            display: flex; justify-content: center; align-items: center;
            font-weight: bold; color: var(--gold); margin-right: 15px;
        }
        .s-info h3 { margin: 0; font-size: 16px; font-weight: 600; }
        .s-info p { margin: 4px 0 0; font-size: 11px; color: var(--text-mute); text-transform: uppercase; letter-spacing: 1px; }
        .s-arabic { margin-left: auto; font-family: 'Amiri', serif; font-size: 22px; color: var(--gold); }

        /* 4. Reading View (Ayat) */
        .ayat-block {
            padding: 25px 15px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            position: relative;
        }
        .ayat-block.active {
            background: rgba(212, 175, 55, 0.03); /* Highlight Audio */
            border-right: 3px solid var(--gold);
        }
        .ayat-meta {
            display: flex; justify-content: space-between; margin-bottom: 15px;
        }
        .ayat-badge {
            background: rgba(255,255,255,0.1); padding: 4px 10px;
            border-radius: 20px; font-size: 10px; color: var(--gold);
        }
        .ayat-tools i {
            margin-left: 15px; color: #555; font-size: 16px; cursor: pointer;
        }
        .ayat-tools i:active { color: var(--gold); }

        .arabic-text {
            font-family: 'Amiri', serif;
            font-size: 32px; /* Lebih besar */
            line-height: 2.4;
            text-align: right;
            direction: rtl;
            color: #fff;
            margin-bottom: 20px;
        }

        /* TAJWID STYLES (NEON) */
        .tj-allah { color: var(--tj-allah); text-shadow: 0 0 8px rgba(255, 215, 0, 0.4); cursor: pointer; }
        .tj-ghunnah { color: var(--tj-ghunnah); text-shadow: 0 0 8px rgba(255, 105, 180, 0.4); cursor: pointer; }
        .tj-qalqalah { color: var(--tj-qalqalah); text-shadow: 0 0 8px rgba(0, 255, 255, 0.4); cursor: pointer; }
        .tj-mad { color: var(--tj-mad); text-shadow: 0 0 8px rgba(255, 69, 0, 0.4); cursor: pointer; }
        .tj-iqlab { color: var(--tj-iqlab); cursor: pointer; }
        .tj-ikhfa { color: var(--tj-ikhfa); cursor: pointer; }

        .translation { font-size: 14px; line-height: 1.6; color: #bbb; }
        .latin { font-size: 12px; color: var(--gold); margin-bottom: 8px; font-style: italic; }

        /* 5. Bottom Navigation (Fixed) */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; right: 0;
            height: 70px;
            background: var(--bg);
            border-top: 1px solid #222;
            display: flex; justify-content: space-around; align-items: center;
            z-index: 100;
            padding-bottom: 10px; /* Safe area for iPhone */
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center;
            color: #555; font-size: 10px; transition: 0.3s;
        }
        .nav-item i { font-size: 20px; margin-bottom: 5px; }
        .nav-item.active { color: var(--gold); }
        .nav-item.active i { transform: translateY(-2px); text-shadow: 0 0 10px var(--gold-glow); }

        /* 6. Mini Player (Sticky) */
        #mini-player {
            position: fixed; bottom: 75px; left: 10px; right: 10px;
            background: rgba(30, 30, 30, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid var(--gold);
            border-radius: 12px;
            padding: 10px 15px;
            display: none; align-items: center; justify-content: space-between;
            z-index: 90;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
        }
        .player-info { display: flex; flex-direction: column; }
        .player-title { font-size: 12px; color: var(--gold); font-weight: bold; }
        .player-time { font-size: 10px; color: #fff; }
        .player-controls i { font-size: 20px; color: #fff; margin-left: 15px; }

        /* 7. Popups & Overlays */
        #night-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 0, 0, 0.2); mix-blend-mode: multiply;
            pointer-events: none; z-index: 9999; display: none;
        }

        #tajwid-popup {
            position: fixed; bottom: 150px; left: 50%; transform: translateX(-50%);
            background: rgba(10, 10, 10, 0.95);
            border: 1px solid var(--gold);
            padding: 15px; border-radius: 12px;
            width: 80%; text-align: center;
            display: none; z-index: 200;
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
        }
        #tajwid-popup h4 { margin: 0 0 5px 0; color: var(--gold); font-size: 14px; }
        #tajwid-popup p { margin: 0; font-size: 12px; color: #fff; }

        /* Utilities */
        .hidden { display: none !important; }
        .btn-full { width: 100%; padding: 15px; background: var(--gold); border: none; border-radius: 10px; font-weight: bold; margin-top: 10px; }
        
        /* Modal Fullscreen */
        .fs-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg); z-index: 200; overflow-y: auto;
            display: none; padding: 20px;
        }
        .fs-header { display: flex; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #222; padding-bottom: 15px; }
        .fs-header i { font-size: 20px; margin-right: 15px; }
        .fs-header h2 { margin: 0; font-size: 18px; color: var(--gold); }

    </style>
</head>
<body>

    <div id="night-overlay"></div>
    <div id="tajwid-popup">
        <h4 id="tp-title">Hukum</h4>
        <p id="tp-desc">Penjelasan</p>
    </div>

    <audio id="audio-engine" preload="none"></audio>
    <div id="mini-player">
        <div class="player-info">
            <span class="player-title" id="mp-title">Surah - Ayat</span>
            <span class="player-time" id="mp-time">00:00 / 00:00</span>
        </div>
        <div class="player-controls">
            <i class="fas fa-step-backward" onclick="playerPrev()"></i>
            <i class="fas fa-play" id="mp-play-btn" onclick="playerToggle()"></i>
            <i class="fas fa-step-forward" onclick="playerNext()"></i>
        </div>
    </div>

    <div class="top-bar">
        <div class="app-logo"><i class="fas fa-quran"></i> RIFQY OLED</div>
        <div class="clock-widget">
            <span id="clock-syuruq">Syu: --:--</span><br>
            <span id="clock-dhuha" style="color: var(--gold);">Dhu: --:--</span>
        </div>
    </div>

    <div id="main-view">
        <div id="tab-home">
            <div id="last-read-card" onclick="resumeLastRead()" style="background: linear-gradient(135deg, #1e1e1e, #000); padding: 20px; border-radius: 16px; margin-bottom: 20px; border: 1px solid #333; display: none;">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <span style="font-size:10px; color:var(--gold); letter-spacing:1px; text-transform:uppercase;">Terakhir Dibaca</span>
                        <h3 id="lr-title" style="margin:5px 0; color:#fff;">Al-Fatihah</h3>
                        <span id="lr-ayah" style="font-size:12px; color:#888;">Ayat 1</span>
                    </div>
                    <i class="fas fa-bookmark" style="font-size:24px; color:var(--gold);"></i>
                </div>
            </div>
            
            <div id="surah-container">
                <div style="text-align:center; margin-top:50px; color:#555;">
                    <i class="fas fa-circle-notch fa-spin" style="font-size:24px;"></i><br><br>Memuat Data Al-Quran...
                </div>
            </div>
        </div>

        <div id="tab-tools" class="hidden" style="padding-bottom: 50px;">
            <h2 style="color:var(--gold);">Toolbox Islami</h2>
            
            <div class="surah-card" onclick="openModal('tasbih')">
                <div class="s-num" style="border-color:var(--tj-qalqalah); color:var(--tj-qalqalah);"><i class="fas fa-fingerprint"></i></div>
                <div class="s-info"><h3>Tasbih Digital</h3><p>Dengan Haptic Feedback</p></div>
            </div>

            <div class="surah-card" onclick="openModal('zakat')">
                <div class="s-num" style="border-color:var(--tj-iqlab); color:var(--tj-iqlab);"><i class="fas fa-hand-holding-heart"></i></div>
                <div class="s-info"><h3>Baitul Maal</h3><p>Kalkulator Zakat & Sedekah</p></div>
            </div>

            <div class="surah-card" onclick="openModal('doa')">
                <div class="s-num" style="border-color:var(--tj-ghunnah); color:var(--tj-ghunnah);"><i class="fas fa-praying-hands"></i></div>
                <div class="s-info"><h3>Kumpulan Doa</h3><p>Doa Harian Lengkap</p></div>
            </div>

            <div class="surah-card" onclick="toggleNightVision()">
                <div class="s-num" style="border-color:red; color:red;"><i class="fas fa-eye"></i></div>
                <div class="s-info"><h3>Night Vision</h3><p>Filter Merah Anti-Silau</p></div>
            </div>
        </div>

        <div id="tab-settings" class="hidden">
            <h2 style="color:var(--gold);">Pengaturan</h2>
            
            <div style="background:#111; padding:15px; border-radius:12px; margin-bottom:15px;">
                <label style="display:flex; justify-content:space-between; margin-bottom:15px;">
                    <span>Ukuran Font Arab</span>
                    <span id="lbl-font">32px</span>
                </label>
                <input type="range" min="24" max="50" value="32" oninput="changeFontSize(this.value)" style="width:100%; accent-color:var(--gold);">
            </div>

            <div class="surah-card">
                <div class="s-info">
                    <h3>Mode Tajwid Pro</h3>
                    <p>Warna & Popup Interaktif</p>
                </div>
                <input type="checkbox" id="chk-tajwid" checked onchange="toggleTajwid()" style="width:20px; height:20px; accent-color:var(--gold);">
            </div>

            <div class="surah-card">
                <div class="s-info">
                    <h3>Layar Selalu Nyala</h3>
                    <p>Mencegah HP Sleep</p>
                </div>
                <input type="checkbox" id="chk-wake" onchange="toggleWakeLock()" style="width:20px; height:20px; accent-color:var(--gold);">
            </div>

            <div class="surah-card" onclick="clearCache()">
                <div class="s-info">
                    <h3 style="color:red;">Hapus Data Cache</h3>
                    <p>Jika aplikasi error/berat</p>
                </div>
                <i class="fas fa-trash" style="color:red;"></i>
            </div>
        </div>
    </div>

    <div id="read-view" class="fs-modal">
        <div class="fs-header" style="position:sticky; top:0; background:var(--bg); z-index:10; border-bottom:1px solid #333;">
            <i class="fas fa-arrow-left" onclick="closeReadView()"></i>
            <div>
                <h2 id="rv-title">Surah Name</h2>
                <span id="rv-info" style="font-size:12px; color:#777;">Info</span>
            </div>
        </div>
        <div id="rv-container" style="padding-bottom:100px;">
            </div>
    </div>

    <div id="modal-content" class="fs-modal">
        <div class="fs-header">
            <i class="fas fa-arrow-left" onclick="closeModalContent()"></i>
            <h2 id="mc-title">Judul</h2>
        </div>
        <div id="mc-body"></div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('home', this)">
            <i class="fas fa-book-quran"></i> Quran
        </div>
        <div class="nav-item" onclick="switchTab('tools', this)">
            <i class="fas fa-layer-group"></i> Tools
        </div>
        <div class="nav-item" onclick="switchTab('settings', this)">
            <i class="fas fa-sliders-h"></i> Settings
        </div>
    </nav>

<script>
    // --- STATE MANAGEMENT ---
    const STATE = {
        surahs: [],
        activeSurah: null,
        activeAyahIdx: -1,
        audio: document.getElementById('audio-engine'),
        fontSize: 32,
        tajwidEnabled: true,
        nightMode: false,
        wakeLock: null
    };

    // --- INITIALIZATION ---
    document.addEventListener('DOMContentLoaded', async () => {
        loadLastRead();
        fetchSurahs();
        initClock();
        
        // Audio Event Listeners (Sync UI)
        STATE.audio.addEventListener('timeupdate', () => {
            const cur = STATE.audio.currentTime;
            const dur = STATE.audio.duration || 0;
            document.getElementById('mp-time').innerText = formatTime(cur) + ' / ' + formatTime(dur);
        });

        STATE.audio.addEventListener('ended', () => playerNext());
        STATE.audio.addEventListener('error', () => alert("Gagal memuat audio. Periksa koneksi internet."));
    });

    // --- CORE DATA FETCHING ---
    async function fetchSurahs() {
        try {
            const res = await fetch('https://equran.id/api/v2/surat');
            const data = await res.json();
            STATE.surahs = data.data;
            renderSurahList(STATE.surahs);
        } catch (e) {
            document.getElementById('surah-container').innerHTML = '<p style="text-align:center; color:red;">Gagal koneksi server.<br>Coba refresh.</p>';
        }
    }

    function renderSurahList(list) {
        const html = list.map(s => `
            <div class="surah-card" onclick="openSurah(${s.nomor})">
                <div class="s-num">${s.nomor}</div>
                <div class="s-info">
                    <h3>${s.namaLatin}</h3>
                    <p>${s.arti} • ${s.jumlahAyat} Ayat</p>
                </div>
                <div class="s-arabic">${s.nama}</div>
            </div>
        `).join('');
        document.getElementById('surah-container').innerHTML = html;
    }

    // --- READING ENGINE (THE HEART) ---
    async function openSurah(nomor) {
        // UI Transition
        const modal = document.getElementById('read-view');
        const container = document.getElementById('rv-container');
        document.getElementById('rv-title').innerText = "Memuat...";
        modal.style.display = 'block';
        container.innerHTML = '<div style="text-align:center; margin-top:50px;"><i class="fas fa-spinner fa-spin"></i></div>';

        try {
            const res = await fetch(`https://equran.id/api/v2/surat/${nomor}`);
            const data = await res.json();
            STATE.activeSurah = data.data;

            // Render Info
            document.getElementById('rv-title').innerText = STATE.activeSurah.namaLatin;
            document.getElementById('rv-info').innerText = `${STATE.activeSurah.tempatTurun} • ${STATE.activeSurah.jumlahAyat} Ayat`;

            // Render Ayat
            let content = '';
            
            // Bismillah Header (Kecuali At-Taubah)
            if(nomor !== 9) {
                content += `<div style="text-align:center; font-family:'Amiri'; font-size:30px; margin:20px 0; color:var(--gold);">بِسْمِ اللّٰهِ الرَّحْمٰنِ الرَّحِيْمِ</div>`;
            }

            content += STATE.activeSurah.ayat.map((a, idx) => `
                <div class="ayat-block" id="ayat-${idx}" data-audio="${a.audio['05']}">
                    <div class="ayat-meta">
                        <span class="ayat-badge">${STATE.activeSurah.nomor}:${a.nomorAyat}</span>
                        <div class="ayat-tools">
                            <i class="fas fa-play" onclick="playAyah(${idx})"></i>
                            <i class="fas fa-copy" onclick="copyText(this, '${a.teksArab}', '${a.teksLatin}', '${a.terjemah}')"></i>
                            <i class="fas fa-bookmark" onclick="saveBookmark(${idx})"></i>
                        </div>
                    </div>
                    <div class="arabic-text" style="font-size:${STATE.fontSize}px">
                        ${STATE.tajwidEnabled ? applyTajwid(a.teksArab) : a.teksArab}
                        <span style="color:var(--gold); font-size:0.6em; margin-right:10px;">۝</span>
                    </div>
                    <div class="latin">${a.teksLatin}</div>
                    <div class="translation">${a.terjemah}</div>
                </div>
            `).join('');

            container.innerHTML = content;

            // Smart Memory Scroll (Delayed to allow render)
            const lastScroll = localStorage.getItem(`pos_${nomor}`);
            if(lastScroll) {
                setTimeout(() => {
                    modal.scrollTo(0, parseInt(lastScroll));
                }, 300);
            }

            // Scroll Listener
            modal.onscroll = () => {
                localStorage.setItem(`pos_${nomor}`, modal.scrollTop);
            };

        } catch (e) {
            alert("Gagal membuka surat.");
            closeReadView();
        }
    }

    // --- TAJWID REGEX ENGINE (FIXED) ---
    function applyTajwid(text) {
        // Urutan penting! Jangan ubah urutan replace.
        
        // 1. Lafadz Allah
        text = text.replace(/اللّٰه/g, '<span class="tj-allah" onclick="infoTajwid(\'Lafadz Allah\', \'Tebalkan suara Lam\')">$&</span>');
        
        // 2. Ghunnah (Nun/Mim Tasydid)
        text = text.replace(/([نم])[\u0651]/g, '<span class="tj-ghunnah" onclick="infoTajwid(\'Ghunnah\', \'Tahan dengung 2-3 harakat\')">$&</span>');

        // 3. Qalqalah (Ba Jim Dal Tho Qof + Sukun)
        text = text.replace(/([بجدطق])\u0652/g, '<span class="tj-qalqalah" onclick="infoTajwid(\'Qalqalah\', \'Pantulkan suara\')">$&</span>');

        // 4. Mad Wajib/Jaiz (Tanda Alis/Bendera)
        text = text.replace(/[\u0653]/g, '<span class="tj-mad" onclick="infoTajwid(\'Mad Wajib/Jaiz\', \'Panjangkan 4-5 harakat\')">$&</span>');

        return text;
    }

    function infoTajwid(title, desc) {
        // Haptic Feedback
        if(navigator.vibrate) navigator.vibrate(20);

        const popup = document.getElementById('tajwid-popup');
        document.getElementById('tp-title').innerText = title;
        document.getElementById('tp-desc').innerText = desc;
        
        popup.style.display = 'block';
        
        // Auto hide
        setTimeout(() => { popup.style.display = 'none'; }, 3000);
    }

    // --- AUDIO SYSTEM ---
    function playAyah(idx) {
        STATE.activeAyahIdx = idx;
        const block = document.getElementById(`ayat-${idx}`);
        const url = block.getAttribute('data-audio');
        
        STATE.audio.src = url;
        STATE.audio.play();
        
        // Highlight UI
        document.querySelectorAll('.ayat-block.active').forEach(el => el.classList.remove('active'));
        block.classList.add('active');
        block.scrollIntoView({behavior: "smooth", block: "center"});

        // Mini Player UI
        document.getElementById('mini-player').style.display = 'flex';
        document.getElementById('mp-title').innerText = `${STATE.activeSurah.namaLatin} : ${idx+1}`;
        document.getElementById('mp-play-btn').className = 'fas fa-pause';
        
        // Save Last Read
        saveLastRead(STATE.activeSurah.nomor, STATE.activeSurah.namaLatin, idx+1);
    }

    function playerToggle() {
        if(STATE.audio.paused) {
            STATE.audio.play();
            document.getElementById('mp-play-btn').className = 'fas fa-pause';
        } else {
            STATE.audio.pause();
            document.getElementById('mp-play-btn').className = 'fas fa-play';
        }
    }

    function playerNext() {
        if(STATE.activeSurah && STATE.activeAyahIdx < STATE.activeSurah.ayat.length - 1) {
            playAyah(STATE.activeAyahIdx + 1);
        } else {
            document.getElementById('mp-play-btn').className = 'fas fa-play';
            alert("Akhir Surat");
        }
    }

    function playerPrev() {
        if(STATE.activeSurah && STATE.activeAyahIdx > 0) {
            playAyah(STATE.activeAyahIdx - 1);
        }
    }

    // --- TOOLS & LOGIC ---
    
    // Bookmark / Last Read
    function saveLastRead(surahNum, surahName, ayatNum) {
        if(!surahNum) return; // Logic bookmark manual
        const data = { surahNum, surahName, ayatNum };
        localStorage.setItem('last_read', JSON.stringify(data));
        renderLastReadCard(data);
    }

    function saveBookmark(idx) {
        saveLastRead(STATE.activeSurah.nomor, STATE.activeSurah.namaLatin, idx+1);
        alert("Ditandai sebagai terakhir dibaca");
    }

    function loadLastRead() {
        const raw = localStorage.getItem('last_read');
        if(raw) {
            const data = JSON.parse(raw);
            renderLastReadCard(data);
        }
    }

    function renderLastReadCard(data) {
        const card = document.getElementById('last-read-card');
        card.style.display = 'block';
        document.getElementById('lr-title').innerText = data.surahName;
        document.getElementById('lr-ayah').innerText = `Ayat ${data.ayatNum}`;
        card.onclick = () => {
            openSurah(data.surahNum);
            // Nanti scroll ke ayat manual (logic simplified)
        };
    }

    // Tools Functionality
    function openModal(type) {
        const modal = document.getElementById('modal-content');
        const title = document.getElementById('mc-title');
        const body = document.getElementById('mc-body');
        
        modal.style.display = 'block';
        
        if(type === 'tasbih') {
            title.innerText = "Tasbih Digital";
            body.innerHTML = `
                <div style="text-align:center; margin-top:50px;">
                    <div id="cnt-val" style="font-size:80px; font-weight:bold; color:var(--gold);">0</div>
                    <div onclick="clickTasbih()" style="width:200px; height:200px; border-radius:50%; border:2px solid var(--gold); margin:30px auto; display:flex; align-items:center; justify-content:center;">
                        <i class="fas fa-fingerprint" style="font-size:40px; color:#333;"></i>
                    </div>
                    <button class="btn-full" onclick="resetTasbih()" style="background:#333; color:#fff;">Reset</button>
                </div>
            `;
        } else if (type === 'zakat') {
            title.innerText = "Zakat Calculator";
            body.innerHTML = `
                <div style="padding:20px;">
                    <label>Total Harta (Rp)</label>
                    <input type="number" id="zkt-in" style="width:100%; padding:15px; background:#222; border:none; color:#fff; border-radius:8px; margin-top:10px;">
                    <button class="btn-full" onclick="calcZakat()">Hitung (2.5%)</button>
                    <h2 id="zkt-res" style="text-align:center; margin-top:20px; color:var(--gold);">Rp 0</h2>
                    <p style="text-align:center; color:#555; font-size:12px;">"Bersihkan hartamu agar jiwamu tenang."</p>
                </div>
            `;
        } else if (type === 'doa') {
            title.innerText = "Doa Harian";
            const doas = [
                {t: "Bangun Tidur", a: "الْحَمْدُ لِلَّهِ الَّذِي أَحْيَانَا بَعْدَ مَا أَمَاتَنَا وَإِلَيْهِ النُّشُورُ"},
                {t: "Selamat Dunia Akhirat", a: "رَبَّنَا آتِنَا فِي الدُّنْيَا حَسَنَةً وَفِي الْآخِرَةِ حَسَنَةً وَقِنَا عَذَابَ النَّارِ"}
            ];
            body.innerHTML = doas.map(d => `
                <div style="background:#111; padding:15px; border-radius:10px; margin-bottom:10px;">
                    <h4 style="margin:0; color:var(--gold);">${d.t}</h4>
                    <p style="font-family:'Amiri'; text-align:right; font-size:20px; margin:10px 0;">${d.a}</p>
                </div>
            `).join('');
        }
    }

    // --- UTILS ---
    let tCount = 0;
    function clickTasbih() {
        tCount++;
        document.getElementById('cnt-val').innerText = tCount;
        if(navigator.vibrate) navigator.vibrate(10);
    }
    function resetTasbih() { tCount=0; document.getElementById('cnt-val').innerText = 0; }

    function calcZakat() {
        const val = document.getElementById('zkt-in').value;
        const res = val * 0.025;
        document.getElementById('zkt-res').innerText = "Rp " + res.toLocaleString('id-ID');
    }

    function toggleNightVision() {
        STATE.nightMode = !STATE.nightMode;
        document.getElementById('night-overlay').style.display = STATE.nightMode ? 'block' : 'none';
        alert(STATE.nightMode ? "Mode Malam (Merah) Aktif" : "Mode Malam Nonaktif");
    }

    async function toggleWakeLock() {
        if('wakeLock' in navigator) {
            try {
                if(!STATE.wakeLock) {
                    STATE.wakeLock = await navigator.wakeLock.request('screen');
                } else {
                    STATE.wakeLock.release();
                    STATE.wakeLock = null;
                }
            } catch(e) { console.log(e); }
        }
    }

    function changeFontSize(val) {
        STATE.fontSize = val;
        document.getElementById('lbl-font').innerText = val + 'px';
        document.querySelectorAll('.arabic-text').forEach(el => el.style.fontSize = val + 'px');
    }
    
    function toggleTajwid() {
        STATE.tajwidEnabled = !STATE.tajwidEnabled;
        if(STATE.activeSurah) openSurah(STATE.activeSurah.nomor); // Reload surah
    }

    function copyText(icon, ar, lat, id) {
        const text = `${ar}\n\n${lat}\n\n"${id}"\n\n(Rifqy OLED)`;
        navigator.clipboard.writeText(text);
        icon.style.color = 'var(--gold)';
        setTimeout(() => icon.style.color = '#555', 1000);
    }

    function formatTime(sec) {
        const m = Math.floor(sec / 60);
        const s = Math.floor(sec % 60);
        return `${m}:${s<10?'0'+s:s}`;
    }

    function initClock() {
        // Mock Syuruq Dhuha (Statis untuk contoh, realnya butuh geolocation)
        document.getElementById('clock-syuruq').innerText = "Syuruq 05:45";
        document.getElementById('clock-dhuha').innerText = "Dhuha 06:15";
    }

    function clearCache() {
        localStorage.clear();
        alert("Cache dibersihkan. Aplikasi akan dimuat ulang.");
        location.reload();
    }

    // Navigation Logic
    window.switchTab = function(tabName, el) {
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
        
        ['home', 'tools', 'settings'].forEach(t => {
            document.getElementById('tab-'+t).classList.add('hidden');
        });
        document.getElementById('tab-'+tabName).classList.remove('hidden');
    }

    window.closeReadView = function() {
        document.getElementById('read-view').style.display = 'none';
        STATE.audio.pause();
        document.getElementById('mini-player').style.display = 'none';
    }
    
    window.closeModalContent = function() {
        document.getElementById('modal-content').style.display = 'none';
    }
</script>
</body>
</html>
